# Final assignment github repository.

MDGE 610: Foundations of Bioinformatics.

Dorian Rojas Villalta. Ph.D. Student. February 2026

## Overview

This github contains the [written report](Written_report.pdf) and 
[output data](empiricalInvestigation) for the final assignment of MDGE 610: 
Foundations in bioinformatics.

### Contents

| Path | Description |
|------|-------------|
| `assignment_handout.pdf` | Assignment instructions |
| `Written_report.pdf` | Rendered written report |
| `Written_report.qmd` | Source quarto file of written report |
| `log-likelihood_function_kallisto.png` | Figure 1 of written report |
| `kallisto @ 4e9f29c/` | Submodule of kallisto repository |
| `empiricalInvestigation/EMAlgorithm.h` | Mirror EM algorithm to local kallisto |
| `empiricalInvestigation/gencode.v44.kidx` | Pre-built kallisto index (GENCODE v44 protein-coding transcripts) |
| `empiricalInvestigation/sim_true_counts.txt` | Ground truth transcript counts |
| `empiricalInvestigation/00-raw-data/sim_reads_1.fastq.gz` | Simulated paired-end reads (read 1) |
| `empiricalInvestigation/00-raw-data/sim_reads_2.fastq.gz` | Simulated paired-end reads (read 2) |

The final written report was generated using Quarto in RStudio and rendered in 
pdf. Both the `.qmd` and `.pdf` documents can be found in this repository. This
contains the answers for each of the questions as well as the methods and respective 
code for the empirical investigation. 

The empirical investigation was conducted on a set of simulated data generated by 
the class professor Dr. Jason de Koning. These files were directly downloaded from the
[assignment repository](https://github.com/jasondk/mdge610-kallisto/tree/main) without git cloning.
Details of simulated data are described below:

### Simulated Data Details

- **Reference**: GENCODE v44 human protein-coding transcriptome (110,962 transcripts)
- **Read pairs**: 1,000,000
- **Read length**: 75 bp paired-end
- **Fragment length**: Mean 250 bp, SD 50 bp
- **Sequencing error**: 1% per-base

## Local installation of kallisto

In order to complete the assignment, the kallisto software was installed locally 
in a MacBook Air with Apple M4 10 cores and 16GB of RAM. The implementation of the 
software was conducted using the following command in the terminal:

  ```bash
  # Installing prerequired tools
  ## Git LFS
  brew install git-lfs
  git lfs install
  
  ## CMake
  brew install cmake
  
  # Iniial copy of kallisto
  ## Cloning repository
  git clone https://github.com/pachterlab/kallisto.git
  
  ## Commiting as a submodule
  git submodule add https://github.com/pachterlab/kallisto.git kallisto
  git commit -m 'Original Kallisto'
  git push origin main
  
  ## Copy EMAlgorithm.h mirror file
  cp kallisto/src/EMAlgorithm.h .
  mv EMAlgorithm.h empiricalInvestigation 
  git commit -m 'Original EM algorithm code'
  git push origin main
  
  # Installion of local kallisto software
  ## Removing incompatibility arguments (x86-only -mno-avx2 flag)
  cd kallisto
  sed -i '' 's/-mno-avx2//g' ext/bifrost/CMakeLists.txt
  
  ## Fix the DataStorage.tcc typo (see #488)
  sed -i '' 's/o\.sz_link\[i\]\.load()/o.unitig_cs_link[i].load()/' ext/bifrost/src/DataStorage.tcc
  
  ## Configure
  mkdir build && cd build
  CMAKE_POLICY_VERSION_MINIMUM=3.5 cmake .. -DENABLE_AVX2=OFF -DCOMPILATION_ARCH=OFF -DCMAKE_POLICY_VERSION_MINIMUM=3.5
  
  ## Build (|| handles a possible race condition on first run)
  CMAKE_POLICY_VERSION_MINIMUM=3.5 make -j$(sysctl -n hw.ncpu) || make -j$(sysctl -n hw.ncpu)
  
  ## Verification
  kallisto version 
    #> kallisto, version 0.51.1
  ```
> Note: several modification were made over the installation instructions to fit the
local computer in which was installed. The authors thanks the professor the help
provided over the solution to these issues. To see the original installation instruction
visit the [kallisto GitHub repository](https://github.com/pachterlab/kallisto).

The [kallisto folder](https://github.com/pachterlab/kallisto) here stored represents a direct link 
to the original repository. Thus, a copy of the [expectation-maximization (EM) algorithm](/empiricalInvestigation/EMAlgorithm.h)
was created allowing for direct modification and track changes of the pertinent 
alterations of the convergence criteria for the purpose of this assignment. This document 
represents a mirror of modifications performed on the local repository cloned that 
could not be directly pushed into the current remote.

## Brief assignment methods

This assignment aims to understand the effect of convergence criteria values into
the relative difference between analyzed simulated data and their ground truth. 
For this, the convergence criteria of minimum threshold of abundance (`alpha_change_limit`) 
and maximum variance between iteration (`alpha_change`) were modified in the 
`EMAlgorithm.h` file. Each parameter value was defined with an alphabet letter 
(abundance threshold = A-E; variance threshold = Z-V) and a paired combination 
was assigned as output folder prefix for tracking purposes. Specific parameter 
values definition and assigned letters combinations are stated below.

|         |A (1.0)|B (0.1)|C (0.01; default)|D (0.001)|E (0.0001)[^1]|
|:--------|:-----:|:-----:|:---------------:|:-------:|:--------:|
| **V (2.0)** | AV | BV |     CV      | DV | EV |
| **W (1.5) **| AW | BW |     CW      | DW | EW |
| **X (1.0; default)** | AX | BX |     CX      | DX | EX |
| **Y (0.5)** | AY | BY |     CY      | DY | EY |
| **Z (0.1)[^2]** | AZ | BZ |     CZ      | DZ | EZ |

: Prefix combinations for convergence criteria analysis.
[^1]: Letters A-E represent values for minimum threshold of abundance
[^2]: Letters Z-V represent the maximum variable between iterations.


The relative difference between each trial and the difference in estimated 
abundances and ground truth were assessed using false positive counts and 
correlation analysis.

## Main findings 

[]

## Acknowledgements

This assignment is dedicated to David Rojas Rodr√≠guez, who heard the author
talk about expectation-maximization and equivalence classes for over a week. He 
said he enjoyed listening to audio messages about the topic like a podcast while 
doing the dishes.
